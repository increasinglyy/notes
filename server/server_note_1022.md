# 一些流程

## 新用户申请服务器

1. 统计：所在的项目组、是否使用GPU、该组是否有其他人

2. 修改服务器手册（组id ---> `cat /etc/groups`)，加入新组或者旧组

3. 创建用户组 `sudo groupadd abc -g 1700` （从 `groupadd --help` 可以查到 `-g` 这个选项

4. 创建用户 `sudo useradd zhangsan`

5. 设置用户密码 `sudo passwd zhangsan`

6. 加组（修改用户信息）（自己是默认用户组）`usermod --help`

   `usermod -g abc zhangsan` (可以按tab键补全)

   通过 `id zhangsan` 他的 `gid` 默认组，`groups` 属于哪些组

7.  远程桌面

以上创建用户可以使用脚本 /home/codewang/sbin/museradd



#### 远程桌面

在使用远程桌面时，服务器端 `--->` 客户端 发送 socket进程，进行通信（将服务器桌面实时刷新到客户端）

客户端 `-->` 服务器端，通过鼠标键盘等控制

远程桌面 关闭后再打开，端口号变了 `--->` 给用户固定端口号



#### 远程桌面配置文件

`cat etc/xrdp/xrdp.ini`

```shell
[globals]
bitmap_cache=yes
bitmap_compression=yes
port=3389      #此端口非远程桌面端口
crypt_level=low
channel_code=1
max_bpp=24

#auto generated by xrdp_manager
[xrdp-0]
name=xxx
lib=libvnc.so
username=xxx
password=xsxsxs
ip=127.0.0.1
port=5915

```

`cat /home/codewang/sbin/xrdp_manager.py`



## 常见问题

#### 1、远程桌面卡死

查看问题 `ps -aux | grep Xvnc | grep jzb`

杀远程 `sudo kill -9 5005` （kill：发送信号9，pid 5005）

创建远程桌面 `sudo python3 /home/comewang/sbin/xrdp_manager.py all`

#### 2、pycharm卡死

`pstree --help`

`pstree -u llx`

`ps -aux | grep pycharm | grep llx`

`pstree -u llx -p | grep pycharm`

#### 3、Linux查看GPU进程

`sudo fuser -v /dev/nvidia0`

（设置环境变量）

#### 4、占用GPU内存

`pstree -u -p | grep 3298`



## 补充

`cat /etc/sudoers` 设置sudo权限

ps 查看用户进程 `ps -aux | grep Xvnc`

